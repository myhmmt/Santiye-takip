<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Şantiye Takip – MVP</title>
  <style>
    :root{--bg:#0b1220;--card:#111827;--line:#1f2937;--muted:#94a3b8}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;background:var(--bg);color:#e5e7eb}
    header{position:sticky;top:0;background:#0b1220cc;backdrop-filter:blur(8px);border-bottom:1px solid var(--line);padding:10px 14px;font-weight:800}
    .wrap{max-width:900px;margin:12px auto;padding:0 12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;margin-top:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    input,select,button,textarea{padding:10px 12px;border-radius:10px;border:1px solid #243244;background:#0b1220;color:#e5e7eb}
    textarea{min-height:80px;width:100%}
    button{background:linear-gradient(90deg,#0ea5e9,#22d3ee);color:#001016;border:none;font-weight:700;cursor:pointer}
    .muted{color:var(--muted)}
    .list{display:flex;flex-direction:column;gap:8px}
    .note{border-left:3px solid #0ea5e9;padding-left:10px}

    /* === Blok seçici (modal + grid) === */
    .modal{position:fixed;inset:0;background:#0008;display:none;align-items:center;justify-content:center;z-index:50}
    .modal.show{display:flex}
    .panel{width:min(900px,96vw);max-height:88vh;overflow:auto;background:#111827;border:1px solid #1f2937;border-radius:16px;padding:14px}
    .grid{display:grid;gap:8px}
    .row1{grid-template-columns:repeat(12,1fr)}  /* AC … AN */
    .row2{grid-template-columns:repeat(13,1fr)}  /* AB … I  */
    .row3{grid-template-columns:repeat(12,1fr)}  /* AA,Z,U,T,A … H */
    .tile{padding:10px 6px;text-align:center;border:1px solid #243244;border-radius:10px;background:#0b1220;cursor:pointer;font-weight:800}
    .tile:hover{outline:2px solid #22d3ee}
    .badge{font-size:10px;color:#94a3b8;display:block;margin-top:4px;font-weight:500}
    .t-41{background:#7c2d4e}  /* 4+1 */
    .t-51{background:#8a6a15}  /* 5+1 */
    .t-62{background:#0f3b46}  /* 6+2 */
    .t-72{background:#153056}  /* 7+2 */
    .own{border-color:#22d3ee}  /* arsa sahibi */
    .patron{outline:2px dashed #22d3ee} /* R: patron */
  </style>
</head>
<body>
  <header>🏗️ Şantiye Takip – MVP (Adım 3: Kaydet + Liste / localStorage)</header>

  <div class="wrap">
    <!-- FORM -->
    <section class="card">
      <h3>Hızlı Kayıt</h3>
      <div class="row">
        <select id="who" style="min-width:140px">
          <option value="">İsim seç</option>
          <option>Muhammet</option><option>Harun</option><option>Metin</option>
          <option>Mert</option><option>Fuat</option><option>Furkan</option>
          <option>Misafir</option>
        </select>

        <div class="row" style="align-items:stretch;flex:1">
          <input id="block" placeholder="Blok (seç butonundan)" style="min-width:140px;flex:1" readonly />
          <button type="button" id="openPicker">Blok Seç</button>
        </div>

        <select id="crew" style="min-width:160px">
          <option value="">Ekip seç</option>
          <option>Elektrik</option><option>Mekanik</option>
          <option>Çatı (kereste)</option><option>Çatı (kiremit)</option><option>Çatı (oluk)</option>
          <option>Denizlik</option><option>Parke</option><option>Seramik</option><option>Boya</option>
          <option>Tg5</option><option>PVC</option><option>Kör Kasa</option><option>Şap</option>
          <option>Dış Cephe</option><option>Makina Alçı</option><option>Saten Alçı</option><option>Kaba Sıva (iç)</option>
        </select>

        <select id="state" style="min-width:150px">
          <option value="başladı">Başladı</option>
          <option value="devam ediyor">Devam ediyor</option>
          <option value="tamamlandı">Tamamlandı</option>
        </select>
      </div>

      <div class="row" style="margin-top:8px">
        <textarea id="text" placeholder="Not (opsiyonel)"></textarea>
      </div>

      <div class="row" style="margin-top:8px">
        <button id="save">Kaydet</button>
        <span id="msg" class="muted"></span>
      </div>
    </section>

    <!-- LİSTE -->
    <section class="card">
      <h3>Son Kayıtlar</h3>
      <div id="list" class="list muted">Kayıt yok.</div>
    </section>
  </div>

  <!-- BLOK SEÇİCİ MODAL -->
  <div id="blkModal" class="modal" aria-hidden="true">
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px">
        <h3 style="margin:0">Blok Seç</h3>
        <button id="closePicker">Kapat</button>
      </div>

      <p class="muted" style="margin:6px 0 12px">
        Renkler: 4+1 <span style="background:#7c2d4e;padding:4px 8px;border-radius:6px"></span>
        &nbsp; 5+1 <span style="background:#8a6a15;padding:4px 8px;border-radius:6px"></span>
        &nbsp; 6+2 <span style="background:#0f3b46;padding:4px 8px;border-radius:6px"></span>
        &nbsp; 7+2 <span style="background:#153056;padding:4px 8px;border-radius:6px"></span>
      </p>

      <!-- Plan sırasına göre 3 sıra -->
      <div class="grid row1" id="row1"></div>
      <div class="grid row2" id="row2" style="margin-top:8px"></div>
      <div class="grid row3" id="row3" style="margin-top:8px"></div>
    </div>
  </div>

  <script>
    /* === Blok listeleri (3 sıra, plan sırası) === */
    const ROW1 = ["AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN"]; // üst sıra (12)
    const ROW2 = ["AB","Y","V","S","R","P","O","N","M","L","K","J","I"];         // orta sıra (13)
    const ROW3 = ["AA","Z","U","T","A","B","C","D","E","F","G","H"];            // alt sıra (12)

    // Daire tipleri (renk)
    const T41 = new Set(["AA","Z","U","T"]);
    const T51 = new Set(["A","B","C","D","E","F","G","H"]);
    const T62 = new Set(["AI","AJ","AK","AL","AM","AN","P","O","N","M","L","K","J","I"]);
    const T72 = new Set(["AC","AD","AE","AF","AG","AH","AB","Y","V","S","R"]);

    // Sahiplik (17 arsa sahibi) + Patron villası R
    const OWNER = new Set(["AC","AD","AH","AI","AJ","Y","R","P","O","N","J","I","Z","A","B","C","H"]);
    const PATRON = "R";

    const el = id => document.getElementById(id);

    /* === Blok seçici === */
    const modal = el('blkModal');
    const openBtn = el('openPicker');
    const closeBtn = el('closePicker');
    const blockInp = el('block');

    const buckets = [
      {row: ROW1, el: el('row1')},
      {row: ROW2, el: el('row2')},
      {row: ROW3, el: el('row3')}
    ];

    function tileClass(code){
      if (T41.has(code)) return 'tile t-41';
      if (T51.has(code)) return 'tile t-51';
      if (T62.has(code)) return 'tile t-62';
      if (T72.has(code)) return 'tile t-72';
      return 'tile';
    }

    function buildPicker(){
      buckets.forEach(({row,el})=>{
        el.innerHTML = '';
        row.forEach(code=>{
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = tileClass(code);
          if (OWNER.has(code)) btn.classList.add('own');
          if (code===PATRON) btn.classList.add('patron');
          btn.innerHTML = code + (code===PATRON ? `<span class="badge">patronun villası 😄</span>` :
                                   OWNER.has(code) ? `<span class="badge">arsa sahibi</span>` : `<span class="badge">müteahhit</span>`);
          btn.onclick = ()=>{ blockInp.value = code; modal.classList.remove('show'); };
          el.appendChild(btn);
        });
      });
    }
    buildPicker();

    openBtn.onclick = ()=> modal.classList.add('show');
    closeBtn.onclick = ()=> modal.classList.remove('show');
    modal.addEventListener('click', e=>{ if(e.target===modal) modal.classList.remove('show'); });

    /* === İsim seçimini hatırla === */
    const whoSel = el('who');
    const savedWho = localStorage.getItem('santiye_who');
    if (savedWho) whoSel.value = savedWho;
    whoSel.addEventListener('change', ()=> localStorage.setItem('santiye_who', whoSel.value));

    /* === Kayıt ve Liste (localStorage) === */
    const KEY = 'santiye_notes_v1';

    function loadNotes(){
      try { return JSON.parse(localStorage.getItem(KEY)) || []; }
      catch { return []; }
    }
    function saveNotes(arr){
      localStorage.setItem(KEY, JSON.stringify(arr));
    }
    function render(){
      const listEl = el('list');
      const items = loadNotes().sort((a,b)=>b.ts - a.ts);
      if(!items.length){
        listEl.classList.add('muted');
        listEl.innerHTML = 'Kayıt yok.';
        return;
      }
      listEl.classList.remove('muted');
      listEl.innerHTML = '';
      items.forEach(n=>{
        const when = new Date(n.ts).toLocaleString();
        const div = document.createElement('div');
        div.className = 'note';
        div.innerHTML = `
          <div style="display:flex;justify-content:space-between;gap:8px">
            <b>${n.block}</b>
            <span class="muted">${when}</span>
          </div>
          <div class="muted" style="margin:4px 0">${n.crew} • ${n.state} • ${n.user}</div>
          <div>${n.text||''}</div>
        `;
        listEl.appendChild(div);
      });
    }
    function say(m){ const msg=el('msg'); msg.textContent=m; setTimeout(()=>msg.textContent='',2000) }

    el('save').onclick = ()=>{
      const who   = (whoSel.value||'').trim();
      const block = (el('block').value||'').trim().toUpperCase();
      const crew  = (el('crew').value||'').trim();
      const state = el('state').value;
      const text  = (el('text').value||'').trim();

      if(!who)   return say('İsim seç');
      if(!block) return say('Blok seç');
      if(!crew)  return say('Ekip seç');

      const notes = loadNotes();
      notes.push({ user: who, block, crew, state, text, ts: Date.now() });
      saveNotes(notes);
      el('text').value = '';
      say('Kaydedildi ✅');
      render();
    };

    // ilk çizim
    render();
  </script>
</body>
</html>

<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Åantiye Takip â€“ Ekip Ã–nce / GÃ¶rsel Durum</title>
<style>
  :root{--bg:#0b1220;--card:#111827;--line:#1f2937;--muted:#94a3b8}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;background:var(--bg);color:#e5e7eb}
  header{position:sticky;top:0;background:#0b1220cc;backdrop-filter:blur(8px);border-bottom:1px solid var(--line);padding:10px 14px;font-weight:800}
  .wrap{max-width:1000px;margin:12px auto;padding:0 12px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;margin-top:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  input,select,button,textarea{padding:10px 12px;border-radius:10px;border:1px solid #243244;background:#0b1220;color:#e5e7eb}
  textarea{min-height:80px;width:100%}
  button{background:linear-gradient(90deg,#0ea5e9,#22d3ee);color:#001016;border:none;font-weight:700;cursor:pointer}
  .muted{color:var(--muted)}
  .list{display:flex;flex-direction:column;gap:8px}
  .note{border-left:3px solid #0ea5e9;padding-left:10px}

  /* Blok Ä±zgarasÄ± */
  .grid{display:grid;gap:8px}
  .row1{grid-template-columns:repeat(12,1fr)}  /* AC â€¦ AN */
  .row2{grid-template-columns:repeat(13,1fr)}  /* AB â€¦ I  */
  .row3{grid-template-columns:repeat(12,1fr)}  /* AA,Z,U,T,A â€¦ H */
  .tile{padding:10px 6px;text-align:center;border:1px solid #243244;border-radius:10px;background:#0b1220;cursor:pointer;font-weight:800}
  .badge{font-size:10px;color:#94a3b8;display:block;margin-top:4px;font-weight:500}

  /* Daire tipi renkleri (arka plan tonlarÄ±) */
  .t-41{background:#7c2d4e}
  .t-51{background:#8a6a15}
  .t-62{background:#0f3b46}
  .t-72{background:#153056}
  .own{border-color:#22d3ee}        /* arsa sahibi */
  .patron{outline:2px dashed #22d3ee}/* R: patron */

  /* Ekip durum renkleri (Ã¼st Ã§erÃ§eve) */
  .st-none{box-shadow:0 0 0 3px #374151 inset}       /* gri: baÅŸlanmadÄ± */
  .st-progress{box-shadow:0 0 0 3px #f59e0b inset}   /* sarÄ±: devam */
  .st-done{box-shadow:0 0 0 3px #10b981 inset}       /* yeÅŸil: bitti */

  /* mini legend noktasÄ± */
  .dot{display:inline-block;width:10px;height:10px;border-radius:50%;vertical-align:middle;margin-right:6px}
</style>
</head>
<body>
<header>ğŸ—ï¸ Åantiye Takip â€“ Ekip Ã–nce / GÃ¶rsel Durum</header>

<div class="wrap">

  <!-- 1) EKÄ°P SEÃ‡ + Ã–ZET -->
  <section class="card">
    <h3>1) Ekip SeÃ§</h3>
    <div class="row">
      <select id="crewPick" style="min-width:200px">
        <option value="">Ekip seÃ§</option>
        <option>Elektrik</option><option>Mekanik</option>
        <option>Ã‡atÄ± (kereste)</option><option>Ã‡atÄ± (kiremit)</option><option>Ã‡atÄ± (oluk)</option>
        <option>Denizlik</option><option>Parke</option><option>Seramik</option><option>Boya</option>
        <option>Tg5</option><option>PVC</option><option>KÃ¶r Kasa</option><option>Åap</option>
        <option>DÄ±ÅŸ Cephe</option><option>Makina AlÃ§Ä±</option><option>Saten AlÃ§Ä±</option><option>Kaba SÄ±va (iÃ§)</option>
      </select>

      <span class="muted">Durum: 
        <span class="dot" style="background:#10b981"></span>tamamlandÄ± â€¢
        <span class="dot" style="background:#f59e0b"></span>devam ediyor â€¢
        <span class="dot" style="background:#374151"></span>baÅŸlanmadÄ±
      </span>

      <select id="statusFilter">
        <option value="">TÃ¼mÃ¼</option>
        <option value="done">Sadece tamamlanan</option>
        <option value="progress">Sadece devam eden</option>
        <option value="none">Sadece baÅŸlanmayan</option>
      </select>

      <button id="clearFilter" class="muted" style="background:#0b1220;border:1px solid #243244">Filtreyi sÄ±fÄ±rla</button>
    </div>
  </section>

  <!-- 2) BLOK IZGARASI (EKÄ°BE GÃ–RE DURUM BOYANIR) -->
  <section class="card">
    <h3>2) Blok SeÃ§ (Ekip durumunu renkten gÃ¶r)</h3>

    <div class="grid row1" id="row1"></div>
    <div class="grid row2" id="row2" style="margin-top:8px"></div>
    <div class="grid row3" id="row3" style="margin-top:8px"></div>

    <div class="muted" id="crewHint" style="margin-top:6px">Ä°pucu: Ekip seÃ§, sonra bloklara tÄ±kla.</div>
  </section>

  <!-- 3) HIZLI KAYIT (blok ekip dolu gelir) -->
  <section class="card">
    <h3>3) HÄ±zlÄ± KayÄ±t</h3>
    <div class="row">
      <select id="who" style="min-width:140px">
        <option value="">Ä°sim seÃ§</option>
        <option>Muhammet</option><option>Harun</option><option>Metin</option>
        <option>Mert</option><option>Fuat</option><option>Furkan</option>
        <option>Misafir</option>
      </select>

      <input id="block" placeholder="Blok" style="min-width:120px" readonly />
      <input id="crew"  placeholder="Ekip" style="min-width:160px" readonly />

      <select id="state" style="min-width:150px">
        <option value="baÅŸladÄ±">BaÅŸladÄ±</option>
        <option value="devam ediyor">Devam ediyor</option>
        <option value="tamamlandÄ±">TamamlandÄ±</option>
      </select>
    </div>

    <div class="row" style="margin-top:8px">
      <textarea id="text" placeholder="Not (opsiyonel)"></textarea>
    </div>

    <div class="row" style="margin-top:8px">
      <button id="save">Kaydet</button>
      <span id="msg" class="muted"></span>
    </div>
  </section>

  <!-- 4) SON KAYITLAR -->
  <section class="card">
    <h3>Son KayÄ±tlar</h3>
    <div id="list" class="list muted">KayÄ±t yok.</div>
  </section>

</div>

<script>
  /* ==== Sabit blok dizilimi (3 sÄ±ra) ==== */
  const ROW1 = ["AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN"]; // Ã¼st sÄ±ra (12)
  const ROW2 = ["AB","Y","V","S","R","P","O","N","M","L","K","J","I"];         // orta sÄ±ra (13)
  const ROW3 = ["AA","Z","U","T","A","B","C","D","E","F","G","H"];            // alt sÄ±ra (12)

  // Daire tipleri arka planlarÄ±
  const T41 = new Set(["AA","Z","U","T"]);
  const T51 = new Set(["A","B","C","D","E","F","G","H"]);
  const T62 = new Set(["AI","AJ","AK","AL","AM","AN","P","O","N","M","L","K","J","I"]);
  const T72 = new Set(["AC","AD","AE","AF","AG","AH","AB","Y","V","S","R"]);

  // Sahiplik + Patron
  const OWNER = new Set(["AC","AD","AH","AI","AJ","Y","R","P","O","N","J","I","Z","A","B","C","H"]);
  const PATRON = "R";

  const el = id => document.getElementById(id);

  /* ==== LocalStorage not defteri ==== */
  const KEY = 'santiye_notes_v1';
  const load = () => { try { return JSON.parse(localStorage.getItem(KEY))||[] } catch { return [] } };
  const save = (arr) => localStorage.setItem(KEY, JSON.stringify(arr));

  // Bir ekip iÃ§in her bloktaki SON durumu (tamamlandÄ±/â€¦/yok) hesapla
  function latestStatusByBlockForCrew(crew){
    const notes = load();
    const map = new Map(); // block -> {state, ts}
    notes.forEach(n=>{
      if(n.crew!==crew) return;
      const prev = map.get(n.block);
      if(!prev || (n.ts>prev.ts)) map.set(n.block, {state:n.state, ts:n.ts});
    });
    // state sÄ±nÄ±fÄ±
    const stateClass = (s)=>{
      if(!s) return 'st-none';
      if(s==='tamamlandÄ±') return 'st-done';
      if(s==='devam ediyor') return 'st-progress';
      return 'st-progress'; // "baÅŸladÄ±"yÄ± da progress say
    };
    const out = {};
    [...ROW1, ...ROW2, ...ROW3].forEach(b=>{
      out[b] = stateClass(map.get(b)?.state);
    });
    return out;
  }

  /* ==== Blok Ä±zgarasÄ± Ã§izimi ==== */
  const buckets = [
    {row: ROW1, el: el('row1')},
    {row: ROW2, el: el('row2')},
    {row: ROW3, el: el('row3')}
  ];

  function typeClass(code){
    if (T41.has(code)) return 't-41';
    if (T51.has(code)) return 't-51';
    if (T62.has(code)) return 't-62';
    if (T72.has(code)) return 't-72';
    return '';
  }

  // SeÃ§ili ekibe gÃ¶re durum sÄ±nÄ±fÄ± uygula + filtre uygula
  function paintGrid(){
    const crewSel = el('crewPick').value;
    const filt = el('statusFilter').value; // '', 'done', 'progress', 'none'
    const st = crewSel ? latestStatusByBlockForCrew(crewSel) : {};

    buckets.forEach(({row,el:wrap})=>{
      wrap.innerHTML='';
      row.forEach(code=>{
        const btn = document.createElement('button');
        btn.type='button';
        let cls = `tile ${typeClass(code)}`;
        if (OWNER.has(code)) cls+=' own';
        if (code===PATRON) cls+=' patron';

        // ekip durumuna gÃ¶re Ã¼st Ã§erÃ§eve rengi
        const sClass = st[code] || 'st-none';
        cls += ` ${sClass}`;
        btn.className = cls;

        // filtre uygula (gizle/gÃ¶ster)
        let keep = true;
        if (filt==='done'     && sClass!=='st-done') keep=false;
        if (filt==='progress' && sClass!=='st-progress') keep=false;
        if (filt==='none'     && sClass!=='st-none') keep=false;
        if (!keep) btn.style.display='none';

        const ownerLbl = code===PATRON ? 'patronun villasÄ± ğŸ˜„' : (OWNER.has(code)?'arsa sahibi':'mÃ¼teahhit');
        let stateLbl = 'baÅŸlanmadÄ±';
        if (sClass==='st-done') stateLbl='tamamlandÄ±';
        else if (sClass==='st-progress') stateLbl='devam/bAÅŸladÄ±';
        btn.innerHTML = `${code}<span class="badge">${ownerLbl} â€¢ ${el('crewPick').value?stateLbl:''}</span>`;

        // tÄ±klayÄ±nca formu doldur
        btn.onclick = ()=>{
          const cPick = el('crewPick').value;
          if(!cPick){ alert('Ã–nce ekip seÃ§'); return; }
          el('block').value = code;
          el('crew').value  = cPick;
          // form bÃ¶lÃ¼mÃ¼ne kaydÄ±r
          document.querySelectorAll('.card')[2].scrollIntoView({behavior:'smooth'});
        };
        wrap.appendChild(btn);
      });
    });

    // ipucu metni
    el('crewHint').textContent = el('crewPick').value ? 'Bir bloÄŸa tÄ±kla: form otomatik dolacak.' : 'Ä°pucu: Ekip seÃ§, sonra bloklara tÄ±kla.';
  }

  /* ==== Form: isim hatÄ±rlama ==== */
  const whoSel = el('who');
  const savedWho = localStorage.getItem('santiye_who');
  if (savedWho) whoSel.value = savedWho;
  whoSel.addEventListener('change', ()=> localStorage.setItem('santiye_who', whoSel.value));

  /* ==== KayÄ±t & Liste ==== */
  function say(m){ const msg=el('msg'); msg.textContent=m; setTimeout(()=>msg.textContent='',2000) }

  function renderList(){
    const listEl = el('list');
    const items = load().sort((a,b)=>b.ts-a.ts);
    if(!items.length){ listEl.classList.add('muted'); listEl.textContent='KayÄ±t yok.'; return; }
    listEl.classList.remove('muted'); listEl.innerHTML='';
    items.forEach(n=>{
      const when = new Date(n.ts).toLocaleString();
      const div = document.createElement('div');
      div.className='note';
      div.innerHTML = `
        <div style="display:flex;justify-content:space-between;gap:8px">
          <b>${n.block}</b><span class="muted">${when}</span>
        </div>
        <div class="muted" style="margin:4px 0">${n.crew} â€¢ ${n.state} â€¢ ${n.user}</div>
        <div>${n.text||''}</div>`;
      listEl.appendChild(div);
    });
  }

  el('save').onclick = ()=>{
    const who   = (whoSel.value||'').trim();
    const block = (el('block').value||'').trim().toUpperCase();
    const crew  = (el('crew').value||'').trim();
    const state = el('state').value;
    const text  = (el('text').value||'').trim();

    if(!who)   return say('Ä°sim seÃ§');
    if(!crew)  return say('Ekip seÃ§ (Ã¼stten ekip seÃ§ip blok tÄ±kla)');
    if(!block) return say('Blok seÃ§ (Ä±zgaradan tÄ±kla)');

    const arr = load();
    arr.push({ user: who, block, crew, state, text, ts: Date.now() });
    save(arr);
    el('text').value='';
    say('Kaydedildi âœ…');
    renderList();
    paintGrid(); // ekip Ä±zgarasÄ± renkleri gÃ¼ncellensin
  };

  // Filtre ve ekip seÃ§im olaylarÄ±
  el('crewPick').addEventListener('change', ()=>{
    // crew alanÄ±nÄ± da gÃ¼ncelle (kayÄ±t formu iÃ§in)
    el('crew').value = el('crewPick').value || '';
    paintGrid();
  });
  el('statusFilter').addEventListener('change', paintGrid);
  el('clearFilter').addEventListener('click', ()=>{
    el('statusFilter').value='';
    paintGrid();
  });

  // Ä°lk Ã§izimler
  paintGrid();
  renderList();
</script>
</body>
</html>
